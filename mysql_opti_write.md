---
title: MySQL_写入优化
date: 2016-01-17 15:31:00
categories: 技术
tags: [mysql]
description:  索引、提交频率对InnoDB表写入速度的影响，了解有哪些需要注意的

---

ref: [参考链接](http://imysql.com/2014/09/24/mysql-optimization-case-how-index-and-commit-rate-affect-innodb-insert.shtml)

## 索引对写入速度的影响

- 如果有自增列做主键，相对完全没索引的情况，写入速度约提升 3.11%；
- 如果有自增列做主键，并且二级索引，相对完全没索引的情况，写入速度约降低 27.37%；

因此，InnoDB表最好总是有一个自增列做主键。

## 提交频率对写入速度的影响

以表中只有自增列做主键的场景，一次写入数据30万行数据为例：

- 等待全部数据写入完成后，最后再执行commit提交的效率最高；
- 每10万行提交一次，相对一次性提交，约慢了1.17%；
- 每1万行提交一次，相对一次性提交，约慢了3.01%；
- 每1千行提交一次，相对一次性提交，约慢了23.38%；
- 每100行提交一次，相对一次性提交，约慢了24.44%；
- 每10行提交一次，相对一次性提交，约慢了92.78%；
- 每行提交一次，相对一次性提交，约慢了546.78%，也就是慢了5倍；

因此，最好是等待所有事务结束后再批量提交，而不是每执行完一个SQL就提交一次。

曾经有一次对比测试mysqldump启用extended-insert和未启用导出的SQL脚本，后者比前者慢了不止5倍。

```
重要：这个建议并不是绝对成立的，要看具体的场景。如果是一个高并发的在线业务，就需要尽快提交事务，避免锁范围被扩大。但如果是在非高并发的业务场景，尤其是做数据批量导入的场景下，就建议采用批量提交的方式。
```
