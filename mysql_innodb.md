---
title: MySQL_innoDB
date: 2016-01-17 14:51:00
categories: 技术
tags: [mysql]
description:  mysql innoDB 的特性

---

### 聚集索引-辅助索引
- 主键（聚集索引）- cluster Index
数据本身是按照主键以B+树的形式存储的，聚集索引的叶子节点存放了表的所有记录。
如果没有主键，存储引擎会自动创建一个6字节的列作为主键。
- 辅助索引 - secondary Index
根据索引键创建的一棵B+树，叶子节点仅存放索引键值和该索引键值指向的主键。
通过辅助索引查找数据时，当找到辅助索引的叶子节点后，很可能还需要根据主键值查找聚集索引得到数据。这种查找方式称为书签查找（bookmark lookup）

### B+ 树索引

B+树索引在数据库中的一个特点就是高扇出性。在innodb存储引擎中，每个页的大小为**16K**，因此，在数据库中，B+树的高度一般都在**2~4层**，查找某一键值最多只需要2到4次IO。

由于辅助索引的叶子节点不包含行记录的所有数据，那么每个页可以存放更多的键值，
因此其高度一般小于聚集索引。

真实数据库中的B+树应该是非常扁平的，可以通过向表中顺序插入足够数据的方式来验证InnoDB中的B+树到底有多扁平：
- 每个叶子节点存储了468行数据，每个非叶子节点存储了大约1200个键值，这是一棵平衡的1200路搜索树！
- 对于一个22.1G容量的表，也只需要高度为3的B+树就能存储了，这个容量大概能满足很多应用的需要了。如果把高度增大到4，则B+树的存储容量立刻增大到25.9T之巨！
- 对于一个22.1G容量的表，B+树的高度是3，如果要把非叶节点全部加载到内存也只需要少于18.8M的内存（如何得出的这个结论？因为对于高度为2的树，1203个叶子节点也只需要18.8M空间，而22.1G从良表的高度是3，非叶节点1204个。同时我们假设叶子节点的尺寸是大于非叶节点的，因为叶子节点存储了行数据而非叶节点只有键和少量数据。），只使用如此少的内存就可以保证只需要一次磁盘IO操作就检索出所需的数据，效率是非常之高的。

![](http://7xq67w.com1.z0.glb.clouddn.com/mysql%2Fmysql_btree.png)
http://www.linuxidc.com/upload/2014_10/141026200115181.png

数据参考：[http://www.linuxidc.com/Linux/2014-10/108487.htm](http://www.linuxidc.com/Linux/2014-10/108487.htm)
